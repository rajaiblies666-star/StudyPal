<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StudyPal ‚Äî Platform Belajar Kolaboratif (Prototype)</title>
  <style>
    /* ===== Global styles ===== */
    :root{
      --bg:#f6fbff;
      --card:#ffffff;
      --primary:#0b6fb6; /* main blue */
      --primary-600:#075691;
      --muted:#6b7b8c;
      --accent:#e8f4ff;
      --glass: rgba(255,255,255,0.6);
      --radius:12px;
      --shadow: 0 6px 18px rgba(11,111,182,0.08);
      --mono: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--mono);
      background: linear-gradient(180deg, var(--bg) 0%, #f1f7fc 100%);
      color:#16324f;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom:60px;
    }

    /* ===== Header ===== */
    header{
      position:sticky;
      top:0;
      backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.6);
      border-bottom:1px solid #e6eef8;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:12px 20px;
      z-index:50;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:44px;height:44px;
      border-radius:10px;
      background:linear-gradient(135deg,var(--primary),var(--primary-600));
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
      font-size:18px;box-shadow:var(--shadow);
    }
    .brand h1{margin:0;font-size:18px}
    nav{display:flex;gap:10px;align-items:center}
    .btn{
      padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;
      background:var(--primary);color:#fff;box-shadow:0 6px 14px rgba(11,111,182,0.12)
    }
    .btn.secondary{
      background:transparent;color:var(--primary);border:1px solid rgba(11,111,182,0.12);
      box-shadow:none;font-weight:600;
    }
    .user-chip{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:rgba(11,111,182,0.06);color:var(--primary);font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    .jenjang-selector {
      display: flex;
      gap: 8px;
      margin: 12px 0;
    }
    .jenjang-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid #e6eef8;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    .jenjang-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* ===== Hero ===== */
    .container{max-width:1100px;margin:28px auto;padding:0 18px}
    .hero{
      display:grid;grid-template-columns:1fr 380px;gap:22px;align-items:center;
    }
    .hero-card{
      background:var(--card);padding:28px;border-radius:16px;box-shadow:var(--shadow);
    }
    .hero h2{margin:0 0 6px;font-size:24px}
    .hero p{margin:0 0 16px;color:var(--muted)}
    .hero-actions{display:flex;gap:12px;align-items:center}

    /* ===== Dashboard cards ===== */
    .grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:18px;
    }
    .card{
      background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow);
    }
    .subject{
      display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid #f1f6fb;
    }
    .subject .icon{
      width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;
    }
    .s-math{background:linear-gradient(135deg,#0b6fb6,#3aa0ff)}
    .s-phys{background:linear-gradient(135deg,#ff8a65,#ffb86b)}
    .s-bio{background:linear-gradient(135deg,#4caf50,#8bdc91)}
    .s-eng{background:linear-gradient(135deg,#9c27b0,#c18ce8)}
    .s-indo{background:linear-gradient(135deg,#f44336,#ff6659)}
    .s-ips{background:linear-gradient(135deg,#ff9800,#ffb74d)}
    .s-kimia{background:linear-gradient(135deg,#00bcd4,#4dd0e1)}
    .s-eko{background:linear-gradient(135deg,#795548,#a1887f)}
    .s-geo{background:linear-gradient(135deg,#4caf50,#81c784)}
    .s-sej{background:linear-gradient(135deg,#3f51b5,#5c6bc0)}
    .s-sos{background:linear-gradient(135deg,#e91e63,#f06292)}

    /* ===== Group & forum view ===== */
    .layout{
      display:grid;grid-template-columns:280px 1fr;gap:18px;margin-top:18px;
    }
    .sidebar{
      position:sticky;top:84px;align-self:start;
    }
    .group-list{display:flex;flex-direction:column;gap:10px}
    .group-item{padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef6fc;cursor:pointer}
    .group-item.active{border:2px solid var(--primary);box-shadow:0 8px 20px rgba(11,111,182,0.06)}
    .new-group{display:flex;gap:8px;margin-top:12px}
    .input{padding:10px;border-radius:10px;border:1px solid #e6eef8;flex:1}
    select.input { cursor: pointer; }

    /* forum */
    .forum{
      display:flex;flex-direction:column;gap:12px;
    }
    .post{
      padding:12px;border-radius:10px;background:var(--card);border:1px solid #eef6fb;box-shadow:var(--shadow);
    }
    .post .meta{font-size:13px;color:var(--muted);display:flex;justify-content:space-between}
    .reply-list{margin-top:8px;display:flex;flex-direction:column;gap:8px;padding-left:8px}

    /* footer */
    footer{display:flex;justify-content:center;padding:18px;margin-top:30px;color:var(--muted)}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(6,20,36,0.36);display:none;align-items:center;justify-content:center;z-index:90}
    .modal{background:var(--card);padding:18px;border-radius:12px;min-width:320px;max-width:640px;box-shadow:0 16px 40px rgba(6,20,36,0.18)}
    .modal.show{display:block}

    /* responsive */
    @media (max-width:880px){
      .hero{grid-template-columns:1fr;gap:14px}
      .layout{grid-template-columns:1fr;align-items:start}
      .sidebar{position:static}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
    <div class="logo" style="background:none;box-shadow:none;padding:0;">
  <img src="https://iili.io/Kslta2e.png" alt="StudyPal Logo" style="width:44px;height:44px;border-radius:10px;object-fit:cover;">
</div>

      <div>
        <h1>StudyPal</h1>
        <div class="small">Belajar kolaboratif untuk semua jenjang</div>
      </div>
    </div>
    <nav>
      <button class="btn" id="btn-quiz">Kuis Cepat</button>
      <button class="btn secondary" id="btn-login">Login / Register</button>
      <div id="userArea" style="display:none" class="user-chip"></div>
    </nav>
  </header>

  <main class="container" id="app">
    <!-- Hero -->
    <section class="hero-card hero">
      <div>
        <h2>Belajar lebih mudah bersama teman ‚Äî kapan saja, di mana saja</h2>
        <p>StudyPal membantu siswa dari SD hingga SMA membentuk grup belajar, berdiskusi, dan latihan soal interaktif. Cocok untuk tugas kelompok & persiapan ujian.</p>
        <p class="small" style="color: var(--primary-600); font-style: italic;">*Saat ini masih dalam tahap pengembangan.</p>
        <div class="hero-actions">
          <button class="btn" id="startBtn">Mulai Belajar Sekarang</button>
          <button class="btn secondary" id="learnMore">Lihat Fitur</button>
        </div>

        <!-- Highlights -->
        <div class="grid" style="margin-top:18px">
          <div class="card">
            <strong>Forum Diskusi</strong>
            <div class="small" style="margin-top:6px">Tanya jawab & solusi soal antar siswa.</div>
          </div>
          <div class="card">
            <strong>Grup Belajar</strong>
            <div class="small" style="margin-top:6px">Buat grup sesuai kelas atau topik.</div>
          </div>
          <div class="card">
            <strong>Latihan Soal</strong>
            <div class="small" style="margin-top:6px">Soal acak untuk setiap mata pelajaran.</div>
          </div>
        </div>
      </div>

      <!-- right card: quick access -->
      <aside class="hero-card" style="text-align:center">
        <h3 style="margin-bottom:6px">Dashboard Cepat</h3>
        <p class="small">Pilih jenjang dan mata pelajaran untuk mulai bergabung di grup & berdiskusi</p>
        
        <!-- Jenjang Selector -->
        <div class="jenjang-selector" id="jenjangSelector">
          <button class="jenjang-btn active" data-jenjang="SD">SD</button>
          <button class="jenjang-btn" data-jenjang="SMP">SMP</button>
          <button class="jenjang-btn" data-jenjang="SMA">SMA</button>
        </div>
        
        <div style="margin-top:12px" id="subjectQuick"></div>
      </aside>
    </section>

    <!-- Main layout: sidebar groups + forum -->
    <section id="mainArea" style="display:none" class="layout">
      <div class="sidebar card">
        <h3 style="margin:0 0 8px 0">Grup Study</h3>
        <div class="small">Pilih grup atau buat yang baru</div>
        <div id="groupList" class="group-list" style="margin-top:12px"></div>

        <div class="new-group">
          <input id="newGroupName" class="input" placeholder="Nama grup (contoh: Kelas 11 IPA 1)"/>
          <select id="newGroupSubject" class="input" style="flex:0.8">
            <!-- Options will be populated dynamically -->
          </select>
          <button class="btn" id="btnCreateGroup">Buat</button>
        </div>
      </div>

      <div class="card">
        <div id="groupHeader">
          <h2 style="margin:0">Pilih Grup</h2>
          <div class="small">Gabung ke grup untuk melihat forum</div>
        </div>

        <div id="forumArea" style="margin-top:12px;display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 id="groupTitle" style="margin:0">Group Title</h3>
              <div class="small" id="groupMeta">Mata pelajaran ‚Ä¢ 0 anggota</div>
            </div>
            <div>
              <button class="btn secondary" id="btnLeave">Keluar</button>
              <button class="btn" id="btnJoin">Gabung</button>
              <button class="btn secondary" id="btnQuizSubject" style="margin-left: 8px;">Latihan Soal</button>
            </div>
          </div>

          <!-- Post composer -->
          <div style="margin-top:12px" class="post">
            <div style="display:flex;gap:12px;align-items:flex-start">
              <div style="width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:var(--primary);font-weight:700" id="avatarInitial">A</div>
              <div style="flex:1">
                <textarea id="postText" rows="3" style="width:100%;padding:10px;border-radius:10px;border:1px solid #eef6fb;resize:vertical" placeholder="Tulis pertanyaan atau catatan..."></textarea>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                  <div class="small">Tambahkan gambar atau link (opsional)</div>
                  <div>
                    <button class="btn secondary" id="btnClearPost">Bersihkan</button>
                    <button class="btn" id="btnPost">Kirim</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Post list -->
          <div id="postsContainer" style="margin-top:12px"></div>
        </div>

      </div>
    </section>

    <footer>
      <div class="small">Prototype StudyPal ‚Ä¢ Dibuat untuk tugas SMA ‚Ä¢ Data tersimpan lokal di browser</div>
    </footer>
  </main>

  <!-- Modal: Login/Register -->
  <div id="modal" class="modal-backdrop">
    <div class="modal">
      <h3 id="modalTitle">Login / Register</h3>
      <p class="small" id="modalDesc">Masukkan nama pengguna dan pilih jenjang untuk mulai menggunakan StudyPal</p>
      <input id="inputName" class="input" placeholder="Nama lengkap atau nama panggilan" style="margin-bottom:12px"/>
      <select id="inputJenjang" class="input">
        <option value="">Pilih Jenjang</option>
        <option value="SD">SD (Sekolah Dasar)</option>
        <option value="SMP">SMP (Sekolah Menengah Pertama)</option>
        <option value="SMA">SMA (Sekolah Menengah Atas)</option>
      </select>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn secondary" id="modalCancel">Batal</button>
        <button class="btn" id="modalSave">Simpan</button>
      </div>
    </div>
  </div>

  <!-- Modal: Quiz -->
  <div id="modalQuiz" class="modal-backdrop">
    <div class="modal" style="max-width:520px">
      <h3 id="quizTitle">Kuis Cepat</h3>
      <p class="small" id="quizDesc">Soal acak untuk latihan.</p>
      <p class="small" style="color: var(--muted); font-style: italic;">*Fitur ini masih dalam tahap pengembangan.</p>
      <div id="quizContent" style="margin-top:8px"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div id="quizResult" class="small"></div>
        <div>
          <button class="btn secondary" id="quizClose">Tutup</button>
          <button class="btn" id="quizSubmit">Kirim Jawaban</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***************
     * StudyPal Prototype JS
     * - Simple SPA behavior
     * - localStorage for persistence (groups & posts & username)
     * - Multi jenjang with different subjects
     * - Embedded questions for quizzes (3 per subject)
     ***************/

    // --- Jenjang and Subjects Configuration ---
    const JENJANG_CONFIG = {
      SD: {
        name: "SD",
        subjects: [
          { name: "Matematika", icon: "üìê", class: "s-math" },
          { name: "Bahasa Indonesia", icon: "üìñ", class: "s-indo" },
          { name: "IPA", icon: "üî¨", class: "s-bio" },
          { name: "IPS", icon: "üåç", class: "s-ips" }
        ]
      },
      SMP: {
        name: "SMP",
        subjects: [
          { name: "Matematika", icon: "üìê", class: "s-math" },
          { name: "Bahasa Indonesia", icon: "üìñ", class: "s-indo" },
          { name: "IPA", icon: "üî¨", class: "s-bio" },
          { name: "IPS", icon: "üåç", class: "s-ips" },
          { name: "Bahasa Inggris", icon: "üá¨üáß", class: "s-eng" }
        ]
      },
      SMA: {
        name: "SMA",
        subjects: [
          { name: "Matematika", icon: "üìê", class: "s-math" },
          { name: "Fisika", icon: "‚ö°", class: "s-phys" },
          { name: "Biologi", icon: "üß¨", class: "s-bio" },
          { name: "Kimia", icon: "üß™", class: "s-kimia" },
          { name: "Bahasa Indonesia", icon: "üìñ", class: "s-indo" },
          { name: "Bahasa Inggris", icon: "üá¨üáß", class: "s-eng" },
          { name: "Ekonomi", icon: "üí∞", class: "s-eko" },
          { name: "Geografi", icon: "üó∫Ô∏è", class: "s-geo" },
          { name: "Sejarah", icon: "üìú", class: "s-sej" },
          { name: "Sosiologi", icon: "üë•", class: "s-sos" }
        ]
      }
    };

    // --- Embedded Questions Bank (3 per subject) ---
    const QUESTIONS_BANK = {
      SD: {
        "Matematika": [
          { q: "Hasil dari 5 + 3 adalah...", a: ["7", "8", "9"], correct: 1 },
          { q: "Angka romawi untuk 10 adalah...", a: ["V", "X", "L"], correct: 1 },
          { q: "Bentuk dari segitiga memiliki... sisi", a: ["2", "3", "4"], correct: 1 }
        ],
        "Bahasa Indonesia": [
          { q: "Kata 'bermain' adalah kata...", a: ["Benda", "Kerja", "Sifat"], correct: 1 },
          { q: "Huruf kapital untuk awal kalimat adalah huruf...", a: ["Kecil", "Besar", "Miring"], correct: 1 },
          { q: "Siapa nama tokoh dalam cerita 'Malin Kundang'?", a: ["Bawang Merah", "Malin Kundang", "Timun Mas"], correct: 1 }
        ],
        "IPA": [
          { q: "Sumber energi matahari berasal dari...", a: ["Bumi", "Angkasa", "Air"], correct: 1 },
          { q: "Hewan yang bernapas dengan insang adalah...", a: ["Kucing", "Ikan", "Ayam"], correct: 1 },
          { q: "Bagian tumbuhan yang menyerap air adalah...", a: ["Daun", "Akar", "Batang"], correct: 1 }
        ],
        "IPS": [
          { q: "Ibukota Indonesia adalah...", a: ["Surabaya", "Jakarta", "Bandung"], correct: 1 },
          { q: "Profesi seseorang yang mengajar di sekolah disebut...", a: ["Dokter", "Guru", "Polisi"], correct: 1 },
          { q: "Alat untuk menunjukkan arah disebut...", a: ["Peta", "Kompas", "Globe"], correct: 1 }
        ]
      },
      SMP: {
        "Matematika": [
          { q: "Hasil dari (2 + 3) x 4 adalah...", a: ["20", "14", "11"], correct: 0 },
          { q: "Persamaan garis lurus dengan gradien 2 dan melalui titik (0,3) adalah...", a: ["y = 2x + 3", "y = 3x + 2", "y = 2x - 3"], correct: 0 },
          { q: "Akar kuadrat dari 144 adalah...", a: ["10", "11", "12"], correct: 2 }
        ],
        "Bahasa Indonesia": [
          { q: "Kalimat yang berisi perintah disebut kalimat...", a: ["Berita", "Tanya", "Perintah"], correct: 2 },
          { q: "Majas perbandingan yang menggunakan kata 'bagai' atau 'laksana' disebut...", a: ["Personifikasi", "Simile", "Metafora"], correct: 1 },
          { q: "Struktur teks eksposisi terdiri dari tesis, argumen, dan...", a: ["Koda", "Konklusi", "Orientasi"], correct: 1 }
        ],
        "IPA": [
          { q: "Zat yang tersusun dari satu jenis atom disebut...", a: ["Senyawa", "Unsur", "Campuran"], correct: 1 },
          { q: "Gaya yang bekerja pada benda yang bergerak melingkar disebut...", a: ["Gaya sentripetal", "Gaya sentrifugal", "Gaya gravitasi"], correct: 0 },
          { q: "Organel sel yang berfungsi sebagai tempat respirasi seluler adalah...", a: ["Nukleus", "Mitokondria", "Kloroplas"], correct: 1 }
        ],
        "IPS": [
          { q: "Pendorong utama kegiatan ekonomi masyarakat adalah...", a: ["Kebutuhan", "Keinginan", "Permintaan"], correct: 0 },
          { q: "Lembaga sosial yang dibentuk untuk menjaga ketertiban masyarakat adalah...", a: ["Keluarga", "Negara", "Sekolah"], correct: 1 },
          { q: "Letak geografis Indonesia yang sangat strategis karena berada di antara dua samudra adalah...", a: ["Asia dan Australia", "Samudra Hindia dan Pasifik", "Benua Asia dan Eropa"], correct: 1 }
        ],
        "Bahasa Inggris": [
          { q: "I ____ to school every day.", a: ["go", "goes", "went"], correct: 0 },
          { q: "She is ____ than her sister.", a: ["tall", "taller", "tallest"], correct: 1 },
          { q: "The book is ____ the table.", a: ["in", "on", "at"], correct: 1 }
        ]
      },
      SMA: {
        "Matematika": [
          { q: "Turunan pertama dari f(x) = 3x¬≤ + 2x - 5 adalah...", a: ["6x + 2", "6x - 2", "3x + 2"], correct: 0 },
          { q: "Jika sin A = 3/5, maka cos A adalah...", a: ["4/5", "5/4", "3/4"], correct: 0 },
          { q: "Limit dari (x¬≤ - 4) / (x - 2) saat x mendekati 2 adalah...", a: ["0", "2", "4"], correct: 2 }
        ],
        "Fisika": [
          { q: "Benda bermassa 2 kg dikenai gaya 10 N. Percepatan benda tersebut adalah...", a: ["5 m/s¬≤", "10 m/s¬≤", "20 m/s¬≤"], correct: 0 },
          { q: "Energi kinetik benda bermassa 4 kg yang bergerak dengan kecepatan 3 m/s adalah...", a: ["12 J", "18 J", "24 J"], correct: 1 },
          { q: "Hukum II Newton menyatakan bahwa resultan gaya sama dengan...", a: ["Massa x Percepatan", "Massa / Percepatan", "Percepatan / Massa"], correct: 0 }
        ],
        "Biologi": [
          { q: "Enzim yang menghancurkan protein dalam makanan adalah...", a: ["Amilase", "Protease", "Lipase"], correct: 1 },
          { q: "Pernapasan yang menghasilkan energi paling banyak adalah...", a: ["Anaerob", "Aerob", "Fermentasi"], correct: 1 },
          { q: "Fotosintesis terjadi di dalam organel bernama...", a: ["Mitokondria", "Kloroplas", "Ribosom"], correct: 1 }
        ],
        "Kimia": [
          { q: "Jumlah mol dalam 5,4 gram air (H‚ÇÇO, Ar H=1, O=16) adalah...", a: ["0,1 mol", "0,3 mol", "0,5 mol"], correct: 1 },
          { q: "Reaksi pengikatan antara ion positif dan ion negatif disebut...", a: ["Ikatan Kovalen", "Ikatan Ion", "Ikatan Logam"], correct: 1 },
          { q: "Unsur yang paling elektronegatif adalah...", a: ["Natrium", "Fluor", "Oksigen"], correct: 1 }
        ],
        "Bahasa Indonesia": [
          { q: "Novel 'Siti Nurbaya' karya Marah Rusli termasuk angkatan...", a: ["Balai Pustaka", "Pujangga Baru", "66"], correct: 0 },
          { q: "Kalimat yang mengandung pertentangan makna antara bagian sebelum dan sesudah koma disebut...", a: ["Paralelisme", "Antitesis", "Elipsis"], correct: 1 },
          { q: "Nilai dalam sebuah cerita yang berkaitan dengan kebenaran umum disebut nilai...", a: ["Religius", "Sosial", "Universal"], correct: 2 }
        ],
        "Bahasa Inggris": [
          { q: "If I had studied harder, I ____ the exam.", a: ["would pass", "would have passed", "will pass"], correct: 1 },
          { q: "The train ____ by the time I arrived at the station.", a: ["had left", "has left", "leaves"], correct: 0 },
          { q: "He suggested ____ a break.", a: ["to take", "taking", "take"], correct: 1 }
        ],
        "Ekonomi": [
          { q: "Kebijakan pemerintah untuk menaikkan suku bunga bertujuan untuk...", a: ["Meningkatkan inflasi", "Mengurangi inflasi", "Meningkatkan investasi"], correct: 1 },
          { q: "Badan usaha yang modalnya berasal dari masyarakat umum adalah...", a: ["BUMN", "BUMD", "Perseroan Terbatas"], correct: 2 },
          { q: "Pajak yang beban pemungutannya dapat dialihkan kepada pihak lain disebut pajak...", a: ["Langsung", "Tidak Langsung", "Subjek"], correct: 1 }
        ],
        "Geografi": [
          { q: "Proses pelapukan batuan secara fisika oleh suhu yang ekstrem disebut...", a: ["Pelapukan kimia", "Pelapukan biologis", "Pelapukan fisik"], correct: 2 },
          { q: "Lapisan atmosfer yang paling dekat dengan permukaan bumi adalah...", a: ["Troposfer", "Stratosfer", "Mesosfer"], correct: 0 },
          { q: "Peta yang menunjukkan batas-batas administrasi suatu wilayah disebut peta...", a: ["Topografi", "Administrasi", "Tematik"], correct: 1 }
        ],
        "Sejarah": [
          { q: "Pembacaan teks Proklamasi Kemerdekaan Indonesia dilakukan pada tanggal...", a: ["16 Agustus 1945", "17 Agustus 1945", "18 Agustus 1945"], correct: 1 },
          { q: "Raja yang memerintah Kerajaan Majapahit pada masa keemasan adalah...", a: ["Raden Wijaya", "Hayam Wuruk", "Sriwijaya"], correct: 1 },
          { q: "Kebijakan pemerintah Belanda yang membatasi kekuatan raja-raja lokal disebut...", a: ["Politik Etis", "Kultuur Stelsel", "Politik Balas Budi"], correct: 1 }
        ],
        "Sosiologi": [
          { q: "Proses di mana individu mengadopsi norma dan nilai masyarakat disebut...", a: ["Interaksi", "Sosialisasi", "Akomodasi"], correct: 1 },
          { q: "Kelompok sosial yang keanggotaannya didasarkan pada kedekatan emosional disebut...", a: ["Golongan", "Paguyuban", "Patembayan"], correct: 1 },
          { q: "Perubahan sosial yang terjadi dengan cepat dan drastis disebut...", a: ["Evolusi", "Revolusi", "Reformasi"], correct: 1 }
        ]
      }
    };

    // --- Initial data ---
    const SAMPLE_GROUPS = [
      { id: genId(), name: "Kelas 5 SD", jenjang: "SD", subject: "Matematika", members: [], posts: [] },
      { id: genId(), name: "Kelas 8 IPA", jenjang: "SMP", subject: "IPA", members: [], posts: [] },
      { id: genId(), name: "Kelas 11 IPA 1", jenjang: "SMA", subject: "Fisika", members: [], posts: [] },
      { id: genId(), name: "Reading Club", jenjang: "SMA", subject: "Bahasa Inggris", members: [], posts: [] }
    ];
    const STORAGE_KEY = 'studypal_data_v1';
    const STORAGE_USER = 'studypal_user_v1';

    // --- util ---
    function genId(){ return 'id-' + Math.random().toString(36).slice(2,9) }
    function saveData(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)) }
    function loadData(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ saveData(SAMPLE_GROUPS); return SAMPLE_GROUPS.slice() }
      try{ return JSON.parse(raw) } catch(e){ saveData(SAMPLE_GROUPS); return SAMPLE_GROUPS.slice() }
    }
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // --- state ---
    let groups = loadData();
    let currentUser = localStorage.getItem(STORAGE_USER) || null;
    let currentUserJenjang = localStorage.getItem('studypal_jenjang') || 'SD';
    let currentGroupId = null;
    let currentJenjang = 'SD';
    let currentQuizQuestions = [];

    // --- elements ---
    const btnLogin = document.getElementById('btn-login');
    const userArea = document.getElementById('userArea');
    const modal = document.getElementById('modal');
    const modalSave = document.getElementById('modalSave');
    const modalCancel = document.getElementById('modalCancel');
    const inputName = document.getElementById('inputName');
    const inputJenjang = document.getElementById('inputJenjang');
    const startBtn = document.getElementById('startBtn');
    const learnMoreBtn = document.getElementById('learnMore');
    const mainArea = document.getElementById('mainArea');
    const subjectQuick = document.getElementById('subjectQuick');
    const jenjangSelector = document.getElementById('jenjangSelector');
    const groupListEl = document.getElementById('groupList');
    const btnCreateGroup = document.getElementById('btnCreateGroup');
    const newGroupName = document.getElementById('newGroupName');
    const newGroupSubject = document.getElementById('newGroupSubject');
    const forumArea = document.getElementById('forumArea');
    const groupTitle = document.getElementById('groupTitle');
    const groupMeta = document.getElementById('groupMeta');
    const postsContainer = document.getElementById('postsContainer');
    const postText = document.getElementById('postText');
    const btnPost = document.getElementById('btnPost');
    const btnClearPost = document.getElementById('btnClearPost');
    const avatarInitial = document.getElementById('avatarInitial');
    const btnJoin = document.getElementById('btnJoin');
    const btnLeave = document.getElementById('btnLeave');
    const btnQuiz = document.getElementById('btn-quiz');
    const btnQuizSubject = document.getElementById('btnQuizSubject');
    const modalQuiz = document.getElementById('modalQuiz');
    const quizTitle = document.getElementById('quizTitle');
    const quizDesc = document.getElementById('quizDesc');
    const quizContent = document.getElementById('quizContent');
    const quizSubmit = document.getElementById('quizSubmit');
    const quizClose = document.getElementById('quizClose');
    const quizResult = document.getElementById('quizResult');

    // --- init UI ---
    function init(){
      refreshUserUI();
      renderJenjangSelector();
      renderSubjectQuick();
      renderGroupList();
      attachListeners();
      if(currentUser) {
        document.getElementById('startBtn').textContent = 'Buka Dashboard';
      }
    }

    function refreshUserUI(){
      if(currentUser){
        btnLogin.style.display='none';
        userArea.style.display='flex';
        userArea.textContent = `${currentUser} (${currentUserJenjang})`;
        avatarInitial.textContent = currentUser.slice(0,1).toUpperCase();
      } else {
        btnLogin.style.display='inline-block';
        userArea.style.display='none';
      }
    }

    // --- render jenjang selector ---
    function renderJenjangSelector(){
      jenjangSelector.innerHTML = '';
      Object.keys(JENJANG_CONFIG).forEach(jenjang => {
        const btn = document.createElement('button');
        btn.className = 'jenjang-btn' + (jenjang === currentJenjang ? ' active' : '');
        btn.dataset.jenjang = jenjang;
        btn.textContent = jenjang;
        btn.addEventListener('click', () => selectJenjang(jenjang));
        jenjangSelector.appendChild(btn);
      });
    }

    // --- select jenjang ---
    function selectJenjang(jenjang){
      currentJenjang = jenjang;
      document.querySelectorAll('.jenjang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.jenjang === jenjang);
      });
      renderSubjectQuick();
      renderGroupList();
      updateSubjectSelect();
    }

    // --- render quick subjects ---
    function renderSubjectQuick(){
      subjectQuick.innerHTML = '';
      const subjects = JENJANG_CONFIG[currentJenjang].subjects;
      
      subjects.forEach(subject => {
        const el = document.createElement('div');
        el.className = 'subject';
        el.style.cursor = 'pointer';
        el.dataset.sub = subject.name;
        el.innerHTML = `
          <div class="icon ${subject.class}">${subject.icon}</div>
          <div>
            <div style="font-weight:700">${subject.name}</div>
            <div class="small">Soal & diskusi</div>
          </div>
        `;
        el.addEventListener('click', () => {
          openDashboardForSubject(subject.name);
        });
        subjectQuick.appendChild(el);
      });
    }

    // --- update subject select dropdown ---
    function updateSubjectSelect(){
      newGroupSubject.innerHTML = '';
      const subjects = JENJANG_CONFIG[currentJenjang].subjects;
      subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject.name;
        option.textContent = subject.name;
        newGroupSubject.appendChild(option);
      });
    }

    // --- open dashboard for subject ---
    function openDashboardForSubject(subject){
      mainArea.style.display='grid';
      renderGroupList(currentJenjang, subject);
    }

    // --- render groups ---
    function renderGroupList(jenjangFilter, subjectFilter){
      groupListEl.innerHTML = '';
      let filtered = groups;
      
      if(jenjangFilter) {
        filtered = filtered.filter(g => g.jenjang === jenjangFilter);
      }
      
      if(subjectFilter) {
        filtered = filtered.filter(g => g.subject === subjectFilter);
      }
      
      filtered.forEach(g=>{
        const el = document.createElement('div');
        el.className = 'group-item' + (g.id === currentGroupId ? ' active' : '');
        el.dataset.id = g.id;
        el.innerHTML = `<strong>${g.name}</strong><div class="small" style="margin-top:6px">${g.jenjang} - ${g.subject} ‚Ä¢ ${g.members.length} anggota</div>`;
        el.addEventListener('click', ()=> openGroup(g.id));
        groupListEl.appendChild(el);
      });
    }

    // --- open group view ---
    function openGroup(groupId){
      const g = groups.find(x=>x.id===groupId);
      if(!g) return;
      currentGroupId = groupId;
      forumArea.style.display = 'block';
      groupTitle.textContent = g.name;
      groupMeta.textContent = `${g.jenjang} - ${g.subject} ‚Ä¢ ${g.members.length} anggota`;
      const isMember = currentUser && g.members.includes(currentUser);
      btnJoin.style.display = isMember ? 'none' : 'inline-block';
      btnLeave.style.display = isMember ? 'inline-block' : 'none';
      avatarInitial.textContent = currentUser ? currentUser.slice(0,1).toUpperCase() : 'A';
      renderPosts(g.posts);
      renderGroupList();
    }

    // --- render posts ---
    function renderPosts(posts){
      postsContainer.innerHTML = '';
      if(!posts || posts.length===0){
        postsContainer.innerHTML = `<div class="small">Belum ada postingan di grup ini. Ajak teman untuk berdiskusi!</div>`;
        return;
      }
      posts.slice().reverse().forEach(post=>{
        const el = document.createElement('div');
        el.className = 'post';
        el.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div style="font-weight:700">${escapeHtml(post.author)}</div>
              <div class="meta">${new Date(post.time).toLocaleString()} ‚Ä¢ <span class="small">${post.title || 'Pertanyaan'}</span></div>
            </div>
            <div class="small" style="color:var(--muted)">${post.upvotes || 0} üëç</div>
          </div>
          <div style="margin-top:8px">${escapeHtml(post.content).replace(/\n/g,'<br>')}</div>
          <div class="reply-list" id="replies-${post.id}">
            ${post.replies && post.replies.length ? post.replies.map(r => `<div style="background:#fbfdff;padding:8px;border-radius:8px;border:1px solid #eef6fb"><strong>${escapeHtml(r.author)}</strong> <div class="small">${new Date(r.time).toLocaleString()}</div><div style="margin-top:6px">${escapeHtml(r.text)}</div></div>`).join('') : ''}
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input placeholder="Tulis balasan..." class="input" id="reply-input-${post.id}" />
            <button class="btn secondary" onclick="handleReply('${post.id}')">Kirim</button>
            <button class="btn" onclick="handleUpvote('${post.id}')">üëç Upvote</button>
          </div>
        `;
        postsContainer.appendChild(el);
      });
    }

    // --- make new group ---
    function createGroup(name, jenjang, subject){
      const g = { id: genId(), name: name || ('Grup ' + Math.floor(Math.random()*100)), jenjang: jenjang || currentJenjang, subject: subject || JENJANG_CONFIG[currentJenjang].subjects[0].name, members: [], posts: [] };
      groups.push(g);
      saveData(groups);
      renderGroupList();
      return g;
    }

    // --- post to group ---
    function postToGroup(groupId, title, content){
      const g = groups.find(x=>x.id===groupId);
      if(!g) return;
      const post = { id: genId(), author: currentUser||'Anonim', title: title||'', content: content||'', time: Date.now(), upvotes:0, replies:[] };
      g.posts = g.posts || [];
      g.posts.push(post);
      saveData(groups);
      renderPosts(g.posts);
    }

    // --- reply handler ---
    window.handleReply = function(postId){
      const input = document.getElementById('reply-input-'+postId);
      if(!input) return;
      const text = input.value.trim();
      if(!text) return alert('Isi balasan dulu.');
      const g = groups.find(x=>x.id===currentGroupId);
      if(!g) return;
      const p = g.posts.find(pp=>pp.id===postId);
      if(!p) return;
      p.replies = p.replies || [];
      p.replies.push({ id: genId(), author: currentUser||'Anonim', text, time: Date.now() });
      saveData(groups);
      renderPosts(g.posts);
    }

    // --- upvote handler ---
    window.handleUpvote = function(postId){
      const g = groups.find(x=>x.id===currentGroupId);
      if(!g) return;
      const p = g.posts.find(pp=>pp.id===postId);
      if(!p) return;
      p.upvotes = (p.upvotes || 0) + 1;
      saveData(groups);
      renderPosts(g.posts);
    }

    // --- QUIZ FUNCTIONS ---
    function openQuizForGroup(groupId) {
      const g = groups.find(x=>x.id===groupId);
      if (!g) return;

      quizTitle.textContent = `Latihan Soal: ${g.subject}`;
      quizDesc.textContent = `Soal acak untuk jenjang ${g.jenjang}`;
      modalQuiz.style.display = 'flex';
      quizContent.innerHTML = '<div class="small">Memuat soal...</div>';
      quizResult.textContent = '';

      // Get questions from the local bank
      const questionsForSubject = QUESTIONS_BANK[g.jenjang]?.[g.subject] || [];
      if (questionsForSubject.length === 0) {
        quizContent.innerHTML = '<div class="small">Belum ada soal untuk mata pelajaran ini.</div>';
        return;
      }

      // Take 3 random questions
      currentQuizQuestions = shuffleArray(questionsForSubject).slice(0, 3);
      renderQuiz();
    }

    function renderQuiz(){
      quizContent.innerHTML = '';
      currentQuizQuestions.forEach((it, idx)=>{
        const div = document.createElement('div');
        div.style.marginBottom='10px';
        div.innerHTML = `<div style="font-weight:700">${idx + 1}. ${it.q}</div>`;
        it.a.forEach((opt, i)=>{
          div.innerHTML += `<div style="margin-top:6px"><label><input type="radio" name="q${idx}" value="${i}"> ${opt}</label></div>`;
        });
        quizContent.appendChild(div);
      });
      quizResult.textContent = '';
    }

    function submitQuiz(){
      let score = 0;
      currentQuizQuestions.forEach((it, idx)=>{
        const sel = document.querySelector(`input[name="q${idx}"]:checked`);
        if (sel && Number(sel.value) === it.correct) {
          score++;
        }
      });
      quizResult.textContent = `Skor: ${score} / ${currentQuizQuestions.length}`;
    }

    // --- attach listeners ---
    function attachListeners(){
      btnLogin.addEventListener('click', ()=> openModal());
      startBtn.addEventListener('click', ()=>{
        if(!currentUser) openModal();
        else {
          mainArea.style.display='grid';
          renderGroupList();
        }
      });
      
      learnMoreBtn.addEventListener('click', () => {
        alert('Fitur StudyPal:\n\n1. Forum Diskusi - Tanya jawab & solusi soal antar siswa\n2. Grup Belajar - Buat grup sesuai kelas atau topik\n3. Latihan Soal - Soal acak untuk setiap mata pelajaran\n4. Multi Jenjang - Dari SD hingga SMA dengan mata pelajaran yang berbeda');
      });
      
      modalCancel.addEventListener('click', ()=> closeModal());
      modalSave.addEventListener('click', ()=>{
        const name = inputName.value.trim();
        const jenjang = inputJenjang.value;
        if(!name) return alert('Isi nama dulu.');
        if(!jenjang) return alert('Pilih jenjang pendidikan.');
        currentUser = name;
        currentUserJenjang = jenjang;
        currentJenjang = jenjang;
        localStorage.setItem(STORAGE_USER, currentUser);
        localStorage.setItem('studypal_jenjang', currentUserJenjang);
        closeModal();
        refreshUserUI();
        document.getElementById('startBtn').textContent = 'Buka Dashboard';
        renderJenjangSelector();
        renderSubjectQuick();
        updateSubjectSelect();
      });

      btnCreateGroup.addEventListener('click', ()=>{
        const name = newGroupName.value.trim();
        const subject = newGroupSubject.value;
        if(!name) return alert('Masukkan nama grup.');
        const g = createGroup(name, currentJenjang, subject);
        newGroupName.value='';
        openGroup(g.id);
      });

      btnPost.addEventListener('click', ()=>{
        if(!currentUser) return openModal();
        const text = postText.value.trim();
        if(!text) return alert('Tulis pertanyaan atau catatan terlebih dahulu.');
        postToGroup(currentGroupId, '', text);
        postText.value='';
      });
      btnClearPost.addEventListener('click', ()=> postText.value='');

      btnJoin.addEventListener('click', ()=>{
        if(!currentUser) return openModal();
        const g = groups.find(x=>x.id===currentGroupId);
        if(!g) return;
        if(!g.members.includes(currentUser)) g.members.push(currentUser);
        saveData(groups);
        openGroup(g.id);
      });
      btnLeave.addEventListener('click', ()=>{
        if(!currentUser) return openModal();
        const g = groups.find(x=>x.id===currentGroupId);
        if(!g) return;
        g.members = g.members.filter(m=>m!==currentUser);
        saveData(groups);
        openGroup(g.id);
      });

      // Quiz listeners
      btnQuiz.addEventListener('click', () => {
        if(currentGroupId) {
          openQuizForGroup(currentGroupId);
        } else {
          alert('Silakan pilih grup terlebih dahulu untuk mengakses kuis.');
        }
      });
      
      btnQuizSubject.addEventListener('click', () => {
        if(currentGroupId) {
          openQuizForGroup(currentGroupId);
        } else {
          alert('Silakan pilih grup terlebih dahulu untuk mengakses kuis.');
        }
      });
      
      quizClose.addEventListener('click', ()=> modalQuiz.style.display='none');
      quizSubmit.addEventListener('click', submitQuiz);
    }

    // --- modal functions ---
    function openModal(){
      modal.style.display='flex';
      inputName.value = currentUser || '';
      inputJenjang.value = currentUserJenjang || '';
      inputName.focus();
    }
    function closeModal(){ modal.style.display='none' }

    // --- escape html ---
    function escapeHtml(s){
      if(!s) return '';
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    // init app
    init();
    updateSubjectSelect();

    // expose for debugging (optional)
    window.__studypal = { groups, saveData, loadData };
  </script>
<footer style="background-color:#0d47a1;color:white;text-align:center;padding:20px 10px;margin-top:40px;">
  <h3>StudyPal Official</h3>
  <p>üìç Desa Bungur, Kecamatan Tulakan, Kabupaten Pacitan, Jawa TImur | üìß support@studypal.id</p>
  <div style="margin-top:10px;">
    <a href="#" style="color:#bbdefb;margin:0 10px;text-decoration:none;">Instagram</a> |
    <a href="#" style="color:#bbdefb;margin:0 10px;text-decoration:none;">YouTube</a> |
    <a href="#" style="color:#bbdefb;margin:0 10px;text-decoration:none;">TikTok</a>
  </div>
  <p style="font-size:13px;color:#cfe2f5;margin-top:10px;">¬© 2025 StudyPal ‚Ä¢ Semua Hak Dilindungi</p>
</footer>
</body>
</html>
